<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuickChatter - Real-Time Chat</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    #chat-container { max-width: 500px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; }
    #messages { height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin-bottom: 10px; background: #fafafa; }
    #message-form { display: flex; }
    #message-input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
    #send-btn { padding: 10px 20px; border: none; background: #007bff; color: #fff; border-radius: 4px; margin-left: 8px; cursor: pointer; }
    #send-btn:hover { background: #0056b3; }
  </style>
</head>
<body>
  <div id="chat-container">
    <h2>QuickChatter</h2>
    <div id="messages"></div>
    <form id="message-form">
      <input id="message-input" autocomplete="off" placeholder="Type a message..." />
      <button id="send-btn" type="submit">Send</button>
    </form>
    <div id="emoji-picker" style="margin-top:10px;"></div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const messages = document.getElementById('messages');
    const form = document.getElementById('message-form');
    const input = document.getElementById('message-input');

    // Prompt for username
    let username = '';
    while (!username) {
      username = prompt('Enter your username:');
      if (username) username = username.trim();
    }

    const typingIndicator = document.createElement('div');
    typingIndicator.id = 'typing-indicator';
    typingIndicator.style.fontStyle = 'italic';
    typingIndicator.style.color = '#888';
    messages.parentNode.insertBefore(typingIndicator, messages.nextSibling);

    let typing = false;
    let typingTimeout;

    input.addEventListener('input', function() {
      if (!typing) {
        typing = true;
        socket.emit('typing', username);
      }
      clearTimeout(typingTimeout);
      typingTimeout = setTimeout(() => {
        typing = false;
        socket.emit('stop typing', username);
      }, 1000);
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (input.value) {
        // Add timestamp in 12-hour format with am/pm
        const now = new Date();
        let hours = now.getHours();
        const minutes = now.getMinutes().toString().padStart(2, '0');
        const ampm = hours >= 12 ? 'pm' : 'am';
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        const timestamp = `${hours}:${minutes} ${ampm}`;
        socket.emit('chat message', { username, message: input.value, timestamp });
        input.value = '';
        typing = false;
        socket.emit('stop typing', username);
      }
    });

    socket.on('chat message', function(data) {
      const item = document.createElement('div');
      item.textContent = `[${data.timestamp}] ${data.username}: ${data.message}`;
      messages.appendChild(item);
      messages.scrollTop = messages.scrollHeight;
    });

    // Listen for join/leave notifications
    socket.on('notification', function(msg) {
      const item = document.createElement('div');
      item.textContent = msg;
      item.style.fontStyle = 'italic';
      item.style.color = '#888';
      messages.appendChild(item);
      messages.scrollTop = messages.scrollHeight;
    });

    socket.on('typing', function(name) {
      if (name !== username) {
        typingIndicator.textContent = `${name} is typing...`;
      }
    });

    socket.on('stop typing', function(name) {
      if (name !== username) {
        typingIndicator.textContent = '';
      }
    });

    // Display message history
    socket.on('message history', function(history) {
      messages.innerHTML = '';
      history.forEach(function(data) {
        const item = document.createElement('div');
        item.textContent = `[${data.timestamp}] ${data.username}: ${data.message}`;
        messages.appendChild(item);
      });
      messages.scrollTop = messages.scrollHeight;
    });

    // Emoji picker logic
    const emojiPicker = document.getElementById('emoji-picker');
    const emojis = ['😀','😂','😍','😎','👍','🙏','🎉','😢','😡','🔥','❤️','🥳','😇','🤔','😅','🙌','😜','😏','😭','😬'];
    emojis.forEach(emoji => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.textContent = emoji;
      btn.style.fontSize = '20px';
      btn.style.margin = '2px';
      btn.style.cursor = 'pointer';
      btn.addEventListener('click', () => {
        // Insert emoji at cursor position
        const start = input.selectionStart;
        const end = input.selectionEnd;
        const text = input.value;
        input.value = text.slice(0, start) + emoji + text.slice(end);
        input.focus();
        input.selectionStart = input.selectionEnd = start + emoji.length;
      });
      emojiPicker.appendChild(btn);
    });
  </script>
</body>
</html> 